FROM pritunl/archlinux

ENV GOPATH /go
ENV PATH $PATH:$GOPATH/bin
ENV NODE_PATH /usr/lib/node_modules

RUN cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.backup &&\
	rankmirrors -n 6 /etc/pacman.d/mirrorlist.backup > /etc/pacman.d/mirrorlist &&\
	pacman -S --noconfirm go nodejs npm git &&\
	npm install -g dredd@stable &&\
	mkdir /go &&\
	go get github.com/Masterminds/glide &&\
	npm install -g sha1 &&\
	mkdir -p $GOPATH/src/github.com/jasonrichardsmith/DreddDockerDemo

COPY . $GOPATH/src/github.com/jasonrichardsmith/DreddDockerDemo

RUN cd $GOPATH/src/github.com/jasonrichardsmith/DreddDockerDemo;\
	glide install;\
	go build main.go

WORKDIR $GOPATH/src/github.com/jasonrichardsmith/DreddDockerDemo

ENTRYPOINT dredd/rundredd.sh
